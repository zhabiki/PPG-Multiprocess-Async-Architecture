# *Исследовательский проект «Определение наличия психических расстройств по данным ФПГ» — пример проекта на основе PPG-Mental-Evaluation*

![Диаграмма архитектуры проекта](README-DIAG.svg)


Данный репозиторий содержит реализацию асинхронного мультипроцессного API-сервера на языке Python, предназначенного для приёма фотоплетизмографических данных (ФПГ), их последующей обработки и выполнения предсказаний вероятности наличия психических расстройств с помощью предварительно обученных моделей.

Сервер построен на основе библиотеки FastAPI, а распределение задач реализовано через независимые подпроцессы с использованием `multiprocessing.Queue` для безопасного обмена данными между ними. В архитектуре предусмотрена автоматическая перезапуск подпроцессов при сбоях, а также простой JS-клиент для тестирования работы API.


- Чтобы ознакомиться с описанием, документацией и кодом самой библиотеки, перейдите к основному репозиторию: <br>**https://github.com/zhabiki/PPG-Mental-Evaluation**


## Структура

- lib/ — git-сабмодуль нашей библиотеки PPG-Mental-Evaluation
- sub_exec_py/
  - sub_fastAPI.py — Сервер FastAPI с фоновым потоком для общения с клиентом
  - sub_preprocessor.py — Подпроцесс препроцессинга получаемых данных ФПГ
  - sub_inference.py — Подпроцесс инференса, выполняет все предсказания
- test_response/
  - index.js — Файл для отправки образцов сигнала ФПГ для демонстарции работы
  - package.json — Метаданные и список зависимостей Node.JS
main_deamon.py — Главный демон, запускает и следит за всеми подпроцессами
requirements.txt — Список зависимостей Python


## Запуск

Для запуска самого API-сервера:
1. Клонируйте репозиторий: `git clone https://github.com/bakafox/PPG-Multiprocess-Async-Architecture.git`
2. Чтобы загрузить последнюю версию библиотеки, синхронизируйте сабмодуль: `git submodule update --remote`
3. Установите зависимости Python: `pip install -r ./requirements.txt` (исп. venv при необходимости)
4. Запустите основной процесс — все подпроцессы будут запущены автоматически: `python ./main_deamon.py`

Для запуска демонстрации работы:
1. Перейдите в `test_response` и установите зависимости Node: `npm i`
2. Убедитесь, что API-сервер работает, и выполните `npm run send`
